(function(g){var e={data:undefined,lang:"cn",multiple:false,pagination:true,listSize:10,multipleControlbar:true,maxSelectLimit:0,selectToCloseList:true,initRecord:undefined,dbTable:"tbl",keyField:"id",showField:"name",searchField:undefined,andOr:"AND",orderBy:undefined,pageSize:10,params:undefined,formatItem:undefined,focusDropList:true,autoSelectFirst:true,autoFillResult:true,noResultClean:true,selectOnly:false,inputDelay:0.5,eSelect:undefined,eAjaxSuccess:undefined,eTagRemove:undefined,eClear:undefined};var h=function(l,m){this.setOption(m);this.setLanguage();this.setCssClass();this.setProp();this.setElem(l,m);this.setButtonAttrDefault();this.setInitRecord();this.eDropdownButton();this.eInput();this.eWhole()};h.version="2.9";h.dataKey="selectPageObject";h.objStatusKey="selectPage-self-mark";h.objStatusIndex="selectPage-self-index";h.prototype.setOption=function(n){n.searchField=(n.searchField===undefined)?n.showField:n.searchField;n.andOr=n.andOr.toUpperCase();if(n.andOr!=="AND"&&n.andOr!=="OR"){n.andOr="AND"}var l=["searchField"];for(var m=0;m<l.length;m++){n[l[m]]=this.strToArray(n[l[m]])}n.orderBy=(n.orderBy===undefined)?n.searchField:n.orderBy;n.orderBy=this.setOrderbyOption(n.orderBy,n.showField);if(n.multiple&&!n.selectToCloseList){n.autoFillResult=false;n.autoSelectFirst=false}if(g.type(n.data)==="string"){n.autoSelectFirst=false}if(!n.pagination){n.pageSize=200}if(g.type(n.listSize)!=="number"||n.listSize<0){n.listSize=10}this.option=n};h.prototype.strToArray=function(l){if(!l){return""}return l.replace(/[\s　]+/g,"").split(",")};h.prototype.setOrderbyOption=function(m,p){var l=[],o=[];if(typeof m=="object"){for(var n=0;n<m.length;n++){o=g.trim(m[n]).split(" ");l[n]=(o.length==2)?o:[o[0],"ASC"]}}else{o=g.trim(m).split(" ");l[0]=(o.length==2)?o:(o[0].match(/^(ASC|DESC)$/i))?[p,o[0]]:[o[0],"ASC"]}return l};h.prototype.setLanguage=function(){var l;switch(this.option.lang){case"de":l={add_btn:"Hinzufügen-Button",add_title:"Box hinzufügen",del_btn:"Löschen-Button",del_title:"Box löschen",next:"Nächsten",next_title:"Nächsten"+this.option.pageSize+" (Pfeil-rechts)",prev:"Vorherigen",prev_title:"Vorherigen"+this.option.pageSize+" (Pfeil-links)",first_title:"Ersten (Umschalt + Pfeil-links)",last_title:"Letzten (Umschalt + Pfeil-rechts)",get_all_btn:"alle (Pfeil-runter)",get_all_alt:"(Button)",close_btn:"Schließen (Tab)",close_alt:"(Button)",loading:"lade...",loading_alt:"(lade)",page_info:"num_page_top - num_page_end von cnt_whole",select_ng:"Achtung: Bitte wählen Sie aus der Liste aus.",select_ok:"OK : Richtig ausgewählt.",not_found:"nicht gefunden",ajax_error:"Bei der Verbindung zum Server ist ein Fehler aufgetreten."};break;case"en":l={add_btn:"Add button",add_title:"add a box",del_btn:"Del button",del_title:"delete a box",next:"Next",next_title:"Next"+this.option.pageSize+" (Right key)",prev:"Prev",prev_title:"Prev"+this.option.pageSize+" (Left key)",first_title:"First (Shift + Left key)",last_title:"Last (Shift + Right key)",get_all_btn:"Get All (Down key)",get_all_alt:"(button)",close_btn:"Close (Tab key)",close_alt:"(button)",loading:"loading...",loading_alt:"(loading)",page_info:"num_page_top - num_page_end of cnt_whole",select_ng:"Attention : Please choose from among the list.",select_ok:"OK : Correctly selected.",not_found:"not found",ajax_error:"An error occurred while connecting to server."};break;case"cn":l={add_btn:"添加按钮",add_title:"添加区域",del_btn:"删除按钮",del_title:"删除区域",next:"下一页",next_title:"下"+this.option.pageSize+" (→)",prev:"上一页",prev_title:"上"+this.option.pageSize+" (←)",first_title:"首页 (Shift + ←)",last_title:"尾页 (Shift + →)",get_all_btn:"获得全部 (↓)",get_all_alt:"(按钮)",close_btn:"关闭 (Tab键)",close_alt:"(按钮)",loading:"读取中...",loading_alt:"(读取中)",page_info:"num_page_top - num_page_end (共 cnt_whole)",select_ng:"请注意：请从列表中选择.",select_ok:"OK : 已经选择.",not_found:"无查询结果",ajax_error:"连接到服务器时发生错误！"};break;case"es":l={add_btn:"Agregar boton",add_title:"Agregar una opcion",del_btn:"Borrar boton",del_title:"Borrar una opcion",next:"Siguiente",next_title:"Proximas "+this.option.pageSize+" (tecla derecha)",prev:"Anterior",prev_title:"Anteriores "+this.option.pageSize+" (tecla izquierda)",first_title:"Primera (Shift + Left)",last_title:"Ultima (Shift + Right)",get_all_btn:"Ver todos (tecla abajo)",get_all_alt:"(boton)",close_btn:"Cerrar (tecla TAB)",close_alt:"(boton)",loading:"Cargando...",loading_alt:"(Cargando)",page_info:"num_page_top - num_page_end de cnt_whole",select_ng:"Atencion: Elija una opcion de la lista.",select_ok:"OK: Correctamente seleccionado.",not_found:"no encuentre",ajax_error:"Un error ocurrió mientras conectando al servidor."};break;case"pt-br":l={add_btn:"Adicionar botão",add_title:"Adicionar uma caixa",del_btn:"Apagar botão",del_title:"Apagar uma caixa",next:"Próxima",next_title:"Próxima "+this.option.pageSize+" (tecla direita)",prev:"Anterior",prev_title:"Anterior "+this.option.pageSize+" (tecla esquerda)",first_title:"Primeira (Shift + Left)",last_title:"Última (Shift + Right)",get_all_btn:"Ver todos (Seta para baixo)",get_all_alt:"(botão)",close_btn:"Fechar (tecla TAB)",close_alt:"(botão)",loading:"Carregando...",loading_alt:"(Carregando)",page_info:"num_page_top - num_page_end de cnt_whole",select_ng:"Atenção: Escolha uma opção da lista.",select_ok:"OK: Selecionado Corretamente.",not_found:"não encontrado",ajax_error:"Um erro aconteceu enquanto conectando a servidor."};break;case"ja":l={add_btn:"追加ボタン",add_title:"入力ボックスを追加します",del_btn:"削除ボタン",del_title:"入力ボックスを削除します",next:"次へ",next_title:"次の"+this.option.pageSize+"件 (右キー)",prev:"前へ",prev_title:"前の"+this.option.pageSize+"件 (左キー)",first_title:"最初のページへ (Shift + 左キー)",last_title:"最後のページへ (Shift + 右キー)",get_all_btn:"全件取得 (下キー)",get_all_alt:"画像:ボタン",close_btn:"閉じる (Tabキー)",close_alt:"画像:ボタン",loading:"読み込み中...",loading_alt:"画像:読み込み中...",page_info:"num_page_top - num_page_end 件 (全 cnt_whole 件)",select_ng:"注意 : リストの中から選択してください",select_ok:"OK : 正しく選択されました。",not_found:"(0 件)",ajax_error:"サーバとの通信でエラーが発生しました。"};break}this.message=l};h.prototype.setCssClass=function(){var l={container:"sp_container",container_open:"sp_container_open",re_area:"sp_result_area",result_open:"sp_result_area_open",control_box:"sp_control_box",element_box:"sp_element_box",navi:"sp_navi",results:"sp_results",re_off:"sp_results_off",select:"sp_over",select_ok:"sp_select_ok",select_ng:"sp_select_ng",selected:"sp_selected",input_off:"sp_input_off",message_box:"sp_message_box",disabled:"sp_disabled",button:"sp_button",btn_on:"sp_btn_on",btn_out:"sp_btn_out",input:"sp_input",clear_btn:"sp_clear_btn"};this.css_class=l};h.prototype.setProp=function(){this.prop={disabled:false,current_page:1,max_page:1,is_loading:false,xhr:false,key_paging:false,key_select:false,prev_value:"",selected_text:"",last_input_time:undefined};this.template={tag:{content:'<li class="selected_tag" itemvalue="#item_value#">#item_text#<span class="tag_close">×</span></li>',textKey:"#item_text#",valueKey:"#item_value#"}}};h.prototype.setElem=function(n,r){var m={};var p=g(n).outerWidth();if(p<150){p=150}m.combo_input=g(n).attr({"autocomplete":"off"}).addClass(this.css_class.input).wrap("<div>");if(r.selectOnly){g(m.combo_input).prop("readonly",true)}m.container=g(m.combo_input).parent().addClass(this.css_class.container);if(g(m.combo_input).prop("disabled")){if(r.multiple){g(m.container).addClass(this.css_class.disabled)}else{g(m.combo_input).addClass(this.css_class.input_off)}}g(m.container).width(p);m.button=g("<div>").addClass(this.css_class.button);m.dropdown=g('<span class="bs-caret"><span class="caret"></span></span>');m.clear_btn=g("<div>").append("×").addClass(this.css_class.clear_btn).attr("title","清除内容");m.element_box=g("<ul>").addClass(this.css_class.element_box);if(r.multiple&&r.multipleControlbar){m.control=g("<div>").addClass(this.css_class.control_box)}m.result_area=g("<div>").addClass(this.css_class.re_area);if(r.pagination){m.navi=g("<div>").addClass("pagination").append("<ul>")}m.results=g("<ul>").addClass(this.css_class.results);var l="_text";var t=(g(m.combo_input).attr("id")!==undefined)?g(m.combo_input).attr("id"):g(m.combo_input).attr("name");var q=(g(m.combo_input).attr("name")!==undefined)?g(m.combo_input).attr("name"):"selectPage";var s=q,o=t;if(q.match(/\]$/)){q=q.replace(/\]?$/,l)}else{q+=l}if(t.match(/\]$/)){t=t.replace(/\]?$/,l)}else{t+=l}m.hidden=g('<input type="hidden" class="sp_hidden" />').attr({name:s,id:o}).val("");g(m.combo_input).attr({name:q,id:t});g(m.container).append(m.button).append(m.hidden);g(document.body).append(m.result_area);g(m.button).append(m.dropdown);g(m.result_area).append(m.results);if(r.pagination){g(m.result_area).append(m.navi)}if(r.multiple){if(r.multipleControlbar){g(m.control).append('<button type="button" class="btn btn-default sp_select_all" ><i class="iconfont if-select-all"></i> 全选本页</button>');g(m.control).append('<button type="button" class="btn btn-default sp_unselect_all" ><i class="iconfont if-unselect-all"></i> 取消本页</button>');g(m.control).append('<button type="button" class="btn btn-default sp_clear_all" ><i class="iconfont if-clear"></i> 清除全部</button>');g(m.result_area).prepend(m.control)}g(m.container).addClass("sp_container_combo");g(m.combo_input).addClass("sp_combo_input").before(g(m.element_box));var u=g("<li>").addClass("input_box");g(u).append(g(m.combo_input));g(m.element_box).append(g(u));if(g(m.combo_input).attr("placeholder")){g(m.combo_input).attr("placeholder_bak",g(m.combo_input).attr("placeholder"))}}this.elem=m};h.prototype.setButtonAttrDefault=function(){g(this.elem.button).attr("title",this.message.get_all_btn);g(this.elem.button).attr("title",this.message.close_btn)};h.prototype.setInitRecord=function(m){var l=this;if(g.type(g(l.elem.combo_input).data("init"))!="undefined"){l.option.initRecord=String(g(l.elem.combo_input).data("init"))}if(!l.option.initRecord){if(g(l.elem.combo_input).val()){l.option.initRecord=g(l.elem.combo_input).val()}}g(l.elem.combo_input).val("");if((m&&g(l.elem.hidden).val())||g.type(l.option.initRecord)==="string"){if(!m){g(l.elem.hidden).val(l.option.initRecord)}if(typeof l.option.data==="object"){var o=new Array();var n=m?g(l.elem.hidden).val().split(","):l.option.initRecord.split(",");g.each(n,function(p,r){for(var q=0;q<l.option.data.length;q++){if(l.option.data[q][l.option.keyField]==r){o.push(l.option.data[q]);break}}});if(!l.option.multiple&&o.length>1){o=null}l.afterInit(l,o)}else{g.ajax({dataType:"json",type:"POST",url:l.option.data,data:{searchTable:l.option.dbTable,searchKey:l.option.keyField,searchValue:m?g(l.elem.hidden).val():l.option.initRecord},success:function(p){var q=null;if(l.option.eAjaxSuccess&&g.isFunction(l.option.eAjaxSuccess)){q=l.option.eAjaxSuccess(p)}l.afterInit(l,q.list)},error:function(p,r,q){l.ajaxErrorNotify(l,q)}})}}};h.prototype.afterInit=function(m,n){if(!n){return}if(!g.isArray(n)){n=[n]}var l=function(r){var q=r[m.option.showField];if(m.option.formatItem&&g.isFunction(m.option.formatItem)){try{q=m.option.formatItem(r)}catch(p){}}return q};if(m.option.multiple){m.clearAll(m);g.each(n,function(p,r){var q={text:l(r),value:r[m.option.keyField]};if(!m.isAlreadySelected(m,q)){m.addNewTag(m,q)}});m.tagValuesSet(m);m.inputResize(m)}else{var o=n[0];g(m.elem.combo_input).val(l(o));g(m.elem.hidden).val(o[m.option.keyField]);m.prop.prev_value=l(o);m.prop.selected_text=l(o);if(m.option.selectOnly){g(m.elem.combo_input).attr("title",m.message.select_ok).removeClass(m.css_class.select_ng).addClass(m.css_class.select_ok)}m.putClearButton()}};h.prototype.eDropdownButton=function(){var l=this;g(l.elem.button).mouseup(function(m){m.stopPropagation();if(g(l.elem.result_area).is(":hidden")&&!g(l.elem.combo_input).prop("disabled")){g(l.elem.combo_input).focus()}else{l.hideResults(l)}}).mouseout()};h.prototype.eInput=function(){var m=this,o=m.option,n=m.elem;var l=function(){m.prop.page_move=false;m.suggest(m);m.setCssFocusedInput(m)};g(n.combo_input).keyup(function(p){m.processKey(m,p)}).keydown(function(p){m.processControl(m,p)}).focus(function(p){if(g(n.result_area).is(":hidden")){p.stopPropagation();m.prop.first_show=true;l()}});g(n.container).on("click.SelectPage","div."+m.css_class.clear_btn,function(p){p.stopPropagation();if(!m.disabled(m)){m.clearAll(m);if(o.eClear&&g.isFunction(o.eClear)){o.eClear()}}});g(n.result_area).on("mousedown.SelectPage",function(p){p.stopPropagation()});if(o.multiple){if(o.multipleControlbar){g(".sp_select_all",n.control).on("click.SelectPage",function(p){m.selectAllLine(m)});g(".sp_unselect_all",n.control).on("click.SelectPage",function(p){m.unselectAllLine(m)});g(".sp_clear_all",n.control).on("click.SelectPage",function(p){m.clearAll(m)})}g(n.element_box).on("click.SelectPage",function(q){var p=q.target||q.srcElement;if(g(p).is("ul")){g(n.combo_input).focus()}});g(n.element_box).on("click.SelectPage","span.tag_close",function(){var p=g(this).closest("li");m.removeTag(m,p);l();if(o.eTagRemove&&g.isFunction(o.eTagRemove)){o.eTagRemove(1)}});m.inputResize(m)}};h.prototype.eWhole=function(){var l=this;var m=function(n){g(n.elem.combo_input).val("");if(!n.option.multiple){g(n.elem.hidden).val("")}n.prop.selected_text=""};g(document).off("mousedown.selectPage").on("mousedown.selectPage",function(p){var o=p.target||p.srcElement;var n=g(o).closest("div."+l.css_class.container);g("div."+l.css_class.container+"."+l.css_class.container_open).each(function(){if(this==n[0]){return}var q=g("input."+l.css_class.input,this).data(h.dataKey);if(!g(q.elem.combo_input).val()&&g(q.elem.hidden).val()&&!q.option.multiple){q.prop.current_page=1;m(q);q.hideResults(q);return true}if(g("li",g(q.elem.results)).size()>0){if(q.option.autoFillResult){if(g("li.sp_selected",g(q.elem.results)).size()>0){q.hideResults(q)}else{if(g("li.sp_over",g(q.elem.results)).size()>0){if(g(q.elem.hidden).val()){q.hideResults(q)}else{q.selectCurrentLine(q,true)}}else{if(q.option.autoSelectFirst){if(g(q.elem.hidden).val()){q.hideResults(q)}else{q.nextLine(q);q.selectCurrentLine(q,true)}}else{q.hideResults(q)}}}}else{q.hideResults(q)}}else{if(q.option.noResultClean){m(q)}else{if(!q.option.multiple){g(q.elem.hidden).val("")}}q.hideResults(q)}})})};h.prototype.eResultList=function(){var l=this;g(l.elem.results).children("li").mouseenter(function(){if(l.prop.key_select){l.prop.key_select=false;return}if(!g(this).hasClass(l.css_class.selected)&&!g(this).hasClass("sp_message_box")){g(this).addClass(l.css_class.select);l.setCssFocusedResults(l)}}).mouseleave(function(){g(this).removeClass(l.css_class.select)}).click(function(m){if(l.prop.key_select){l.prop.key_select=false;return}m.preventDefault();m.stopPropagation();if(!g(this).hasClass(l.css_class.selected)){l.selectCurrentLine(l,false)}})};h.prototype.eScroll=function(){var l=this;g(window).on("scroll.SelectPage",function(m){g("div."+l.css_class.container+"."+l.css_class.container_open).each(function(){var t=g("input."+l.css_class.input,this).data(h.dataKey);var s=g(t.elem.result_area).offset();var r=g(window).scrollTop();var v=g(document).height();var p=g(window).height();var o=g(t.elem.result_area).outerHeight();var n=s.top+o;var q=v>p;var u=g(t.elem.result_area).hasClass("shadowDown");if(q){if(u){if(n>(p+r)){t.calcResultsSize(t)}}else{if(s.top<r){t.calcResultsSize(t)}}}})})};h.prototype.ePaging=function(){var l=this;if(!l.option.pagination){return}g("li.csFirstPage",g(l.elem.navi)).off("click").on("click",function(m){m.preventDefault();l.firstPage(l)});g("li.csPreviousPage",g(l.elem.navi)).off("click").on("click",function(m){m.preventDefault();l.prevPage(l)});g("li.csNextPage",g(l.elem.navi)).off("click").on("click",function(m){m.preventDefault();l.nextPage(l)});g("li.csLastPage",g(l.elem.navi)).off("click").on("click",function(m){m.preventDefault();l.lastPage(l)})};h.prototype.ajaxErrorNotify=function(l,m){l.showMessage(l.message.ajax_error)};h.prototype.showMessage=function(l,n){if(!n){return}var m='<li class="sp_message_box"><i class="iconfont if-warning"></i> '+n+"</li>";g(l.elem.results).empty().append(m).show();l.calcResultsSize(l);l.setOpenStatus(l,true);g(l.elem.control).hide();if(l.option.pagination){g(l.elem.navi).hide()}};h.prototype.scrollWindow=function(t,q){var l=t.getCurrentLine(t);var s=(l&&!q)?l.offset().top:g(t.elem.container).offset().top;var n;t.prop.size_li=g(t.elem.results).children("li:first").outerHeight();n=t.prop.size_li;var p=g(window).height();var o=g(window).scrollTop();var m=o+p-n;var r;if(g(l).length){if(s<o||n>p){r=s-o}else{if(s>m){r=s-m}else{return}}}else{if(s<o){r=s-o}}window.scrollBy(0,r)};h.prototype.setOpenStatus=function(m,l){var n=m.elem;if(l){g(n.container).addClass(m.css_class.container_open);g(n.result_area).addClass(m.css_class.result_open)}else{g(n.container).removeClass(m.css_class.container_open);g(n.result_area).removeClass(m.css_class.result_open)}};h.prototype.setCssFocusedInput=function(l){};h.prototype.setCssFocusedResults=function(l){};h.prototype.checkValue=function(m){var l=g(m.elem.combo_input).val();if(l!=m.prop.prev_value){m.prop.prev_value=l;m.prop.first_show=false;if(m.option.selectOnly){m.setButtonAttrDefault()}if(!m.option.multiple&&!l){m.clearAll(m)}m.suggest(m)}};h.prototype.processKey=function(l,m){if(g.inArray(m.keyCode,[37,38,39,40,27,9,13])===-1){if(m.keyCode!=16){l.setCssFocusedInput(l)}l.inputResize(l);if(g.type(l.option.data)==="string"){l.prop.last_input_time=m.timeStamp;setTimeout(function(){if((m.timeStamp-l.prop.last_input_time)===0){l.checkValue(l)}},l.option.inputDelay*1000)}else{l.checkValue(l)}}};h.prototype.processControl=function(l,m){if((g.inArray(m.keyCode,[37,38,39,40,27,9])>-1&&g(l.elem.result_area).is(":visible"))||(g.inArray(m.keyCode,[13,9])>-1&&l.getCurrentLine(l))){m.preventDefault();m.stopPropagation();m.cancelBubble=true;m.returnValue=false;switch(m.keyCode){case 37:if(m.shiftKey){l.firstPage(l)}else{l.prevPage(l)}break;case 38:l.prop.key_select=true;l.prevLine(l);break;case 39:if(m.shiftKey){l.lastPage(l)}else{l.nextPage(l)}break;case 40:if(g(l.elem.results).children("li").length){l.prop.key_select=true;l.nextLine(l)}else{l.suggest(l)}break;case 9:l.prop.key_paging=true;l.selectCurrentLine(l,true);break;case 13:l.selectCurrentLine(l,true);break;case 27:l.prop.key_paging=true;l.hideResults(l);break}}};h.prototype.abortAjax=function(l){if(l.prop.xhr){l.prop.xhr.abort();l.prop.xhr=false}};h.prototype.suggest=function(m){var n;var o=g.trim(g(m.elem.combo_input).val());if(m.option.multiple){n=o}else{if(o&&o===m.prop.selected_text){n=""}else{n=o}}n=n.split(/[\s　]+/);m.abortAjax(m);m.setLoading(m);var l=m.prop.current_page>0?m.prop.current_page:1;if(typeof m.option.data=="object"){m.searchForJson(m,n,l)}else{m.searchForDb(m,n,l)}};h.prototype.setLoading=function(l){if(g(l.elem.results).html()===""){l.setOpenStatus(l,true)}};h.prototype.searchForDb=function(o,r,m){if(!o.option.eAjaxSuccess||!g.isFunction(o.option.eAjaxSuccess)){o.hideResults(o)}var p=o.option.params;var n={};var s=o.option.searchField;if(r.length>0&&r[0]&&r[0]!==o.prop.prev_value){m=1}var q={q_word:r,pageNumber:m,pageSize:o.option.pageSize,andOr:o.option.andOr,orderBy:o.option.orderBy,searchTable:o.option.dbTable};q[s]=r[0];if(p&&g.isFunction(p)){var l=p();if(l&&g.isPlainObject(l)){n=g.extend({},q,l)}else{n=q}}else{n=q}o.prop.xhr=g.ajax({dataType:"json",url:o.option.data,type:"POST",data:n,success:function(w){if(!w||!g.isPlainObject(w)){o.hideResults(o);o.ajaxErrorNotify(o,errorThrown);return}var x=o.option.eAjaxSuccess(w);var v={};v.originalResult=x.list;v.cnt_whole=x.totalRow;v.candidate=[];v.keyField=[];if(typeof v.originalResult!="object"){o.prop.xhr=null;o.notFoundSearch(o);return}v.cnt_page=v.originalResult.length;for(var u=0;u<v.cnt_page;u++){for(var t in v.originalResult[u]){if(t==o.option.keyField){v.keyField.push(v.originalResult[u][t])}if(t==o.option.showField){v.candidate.push(v.originalResult[u][t])}}}o.prepareResults(o,v,r,m)},error:function(t,v,u){if(v!="abort"){o.hideResults(o);o.ajaxErrorNotify(o,u)}},complete:function(){o.prop.xhr=null}})};h.prototype.searchForJson=function(y,q,z){var u=[];var n=[];var l=[];var F={};var C=0;var x=[];do{n[C]=q[C].replace(/\W/g,"\\$&").toString();x[C]=new RegExp(n[C],"gi");C++}while(C<q.length);for(C=0;C<y.option.data.length;C++){var B=false;var s=y.option.data[C];for(var A=0;A<x.length;A++){var t=s[y.option.showField];if(y.option.formatItem&&g.isFunction(y.option.formatItem)){t=y.option.formatItem(s)}if(t.match(x[A])){B=true;if(y.option.andOr=="OR"){break}}else{B=false;if(y.option.andOr=="AND"){break}}}if(B){u.push(s)}}var I=new RegExp("^"+n[0]+"$","gi");var G=new RegExp("^"+n[0],"gi");var H=[];var E=[];var D=[];for(C=0;C<u.length;C++){var w=y.option.orderBy[0][0];var m=String(u[C][w]);if(m.match(I)){H.push(u[C])}else{if(m.match(G)){E.push(u[C])}else{D.push(u[C])}}}if(y.option.orderBy[0][1].match(/^asc$/i)){H=y.sortAsc(y,H);E=y.sortAsc(y,E);D=y.sortAsc(y,D)}else{H=y.sortDesc(y,H);E=y.sortDesc(y,E);D=y.sortDesc(y,D)}l=l.concat(H).concat(E).concat(D);F.cnt_whole=l.length;if(!y.prop.page_move){if(!y.option.multiple){var v=g(y.elem.hidden).val();if(g.type(v)!=="undefined"&&g.trim(v)!==""){var r=0;g.each(l,function(K,L){if(L[y.option.keyField]==v){r=K+1;return false}});z=Math.ceil(r/y.option.pageSize);if(z<1){z=1}y.prop.current_page=z}}}else{if(l.length<=((z-1)*y.option.pageSize)){z=1;y.prop.current_page=1}}var p=(z-1)*y.option.pageSize;var o=p+y.option.pageSize;F.originalResult=[];for(C=p;C<o;C++){if(l[C]===undefined){break}F.originalResult.push(l[C]);for(var J in l[C]){if(J==y.option.keyField){if(F.keyField===undefined){F.keyField=[]}F.keyField.push(l[C][J])}if(J==y.option.showField){if(F.candidate===undefined){F.candidate=[]}F.candidate.push(l[C][J])}}}if(F.candidate===undefined){F.candidate=[]}F.cnt_page=F.candidate.length;y.prepareResults(y,F,q,z)};h.prototype.sortAsc=function(m,l){l.sort(function(p,n){var q=p[m.option.orderBy[0][0]];var o=n[m.option.orderBy[0][0]];return g.type(q)==="number"?q-o:String(q).localeCompare(String(o))});return l};h.prototype.sortDesc=function(m,l){l.sort(function(p,n){var q=p[m.option.orderBy[0][0]];var o=n[m.option.orderBy[0][0]];return g.type(q)==="number"?o-q:String(o).localeCompare(String(q))});return l};h.prototype.notFoundSearch=function(l){g(l.elem.results).empty();l.calcResultsSize(l);l.setOpenStatus(l,true);l.setCssFocusedInput(l)};h.prototype.prepareResults=function(n,o,p,l){if(n.option.pagination){n.setNavi(n,o.cnt_whole,o.cnt_page,l)}if(!o.keyField){o.keyField=false}if(n.option.selectOnly&&o.candidate.length===1&&o.candidate[0]==p[0]){g(n.elem.hidden).val(o.keyField[0]);this.setButtonAttrDefault()}var m=false;if(p&&p.length>0&&p[0]){m=true}n.displayResults(n,o,m)};h.prototype.setNavi=function(y,w,x,m){var n=function(H,E,z,D){if(g("li",g(E)).size()==0){g(E).hide().empty();var B="";var F="iconfont if-first",I="iconfont if-previous",A="iconfont if-next",C="iconfont if-last";if(z==1){B=" disabled "}g(E).append('<li class="csFirstPage'+B+'" title="'+H.message.first_title+'" ><a href="javascript:void(0);"> <i class="'+F+'"></i> </a></li>');g(E).append('<li class="csPreviousPage'+B+'" title="'+H.message.prev_title+'" ><a href="javascript:void(0);"><i class="'+I+'"></i></a></li>');var G="第 "+z+" 页(共"+D+"页)";g(E).append('<li class="pageInfoBox"><a href="javascript:void(0);"> '+G+" </a></li>");if(z==D){B=" disabled "}else{B=""}g(E).append('<li class="csNextPage'+B+'" title="'+H.message.next_title+'" ><a href="javascript:void(0);"><i class="'+A+'"></i></a></li>');g(E).append('<li class="csLastPage'+B+'" title="'+H.message.last_title+'" ><a href="javascript:void(0);"> <i class="'+C+'"></i> </a></li>');g(E).show()}};var t=g("ul",g(y.elem.navi));var r=Math.ceil(w/y.option.pageSize);if(r==0){m=0}else{if(r<m){m=r}else{if(m==0){m=1}}}y.prop.current_page=m;y.prop.max_page=r;n(y,t,m,r);var l=g("li.pageInfoBox",g(t));var v="第 "+m+" 页(共"+r+"页)";g(l).html('<a href="javascript:void(0);"> '+v+" </a>");var s="disabled";var p=g("li.csFirstPage",g(t));var q=g("li.csPreviousPage",g(t));var o=g("li.csNextPage",g(t));var u=g("li.csLastPage",g(t));if(m===1||m===0){if(!g(p).hasClass(s)){g(p).addClass(s)}if(!g(q).hasClass(s)){g(q).addClass(s)}}else{if(g(p).hasClass(s)){g(p).removeClass(s)}if(g(q).hasClass(s)){g(q).removeClass(s)}}if(m==r||r==0){if(!g(o).hasClass(s)){g(o).addClass(s)}if(!g(u).hasClass(s)){g(u).addClass(s)}}else{if(g(o).hasClass(s)){g(o).removeClass(s)}if(g(u).hasClass(s)){g(u).removeClass(s)}}if(r>1){y.ePaging()}};h.prototype.displayResults=function(w,v,o){g(w.elem.results).hide().empty();if(w.option.multiple&&g.type(w.option.maxSelectLimit)==="number"&&w.option.maxSelectLimit>0){var m=g("li.selected_tag",w.elem.element_box).size();if(m>0&&m>=w.option.maxSelectLimit){w.showMessage(w,"最多只能选择 "+w.option.maxSelectLimit+" 个项目");return}}if(v.candidate.length>0){var u=v.candidate;var s=v.keyField;var l=g(w.elem.hidden).val();var x=l?l.split(","):new Array();for(var n=0;n<u.length;n++){var r="";if(w.option.formatItem&&g.isFunction(w.option.formatItem)){try{r=w.option.formatItem(v.originalResult[n])}catch(q){console.error("formatItem内容格式化函数内容设置不正确！");r=u[n]}}else{r=u[n]}var p=g("<li>").html(r).attr({pkey:s[n],title:r});if(g.inArray(s[n].toString(),x)!==-1){g(p).addClass(w.css_class.selected)}g(p).data("dataObj",v.originalResult[n]);g(w.elem.results).append(p)}}else{var t='<li class="sp_message_box"><i class="iconfont if-warning"></i> '+w.message.not_found+"</li>";g(w.elem.results).append(t)}g(w.elem.results).show();if(w.option.multiple&&w.option.multipleControlbar){g(w.elem.control).show()}if(w.option.pagination){g(w.elem.navi).show()}w.calcResultsSize(w);w.setOpenStatus(w,true);w.eResultList();w.eScroll();if(o&&v.candidate.length>0&&w.option.autoSelectFirst){w.nextLine(w)}};h.prototype.calcResultsSize=function(m){var o=m.option,n=m.elem;var l=function(){if(g(n.container).css("position")==="static"){var z=g(n.combo_input).offset();g(n.result_area).css({top:z.top+g(n.combo_input).outerHeight()+"px",left:z.left+"px"})}else{if(!o.pagination){var w=g("li:first",n.results).outerHeight(true);var u=w*o.listSize;g(n.results).css({"max-height":u,"overflow-y":"auto"})}var A=g(document).width();var E=g(document).height();var v=g(window).height();var z=g(n.container).offset();var y=g(window).scrollTop();var D=g(n.result_area).outerWidth();var u=g(n.result_area).outerHeight();var q=z.left;var p=g(n.container).outerHeight();var t=(z.left+D)>A?q-(D-g(n.container).outerWidth()):q;var s=z.top;var C=0,B=5;var r=s+p+u+B;var x=E>v;if((s-y-B>u)&&(x&&r>(v+y))||(!x&&r>v)){C=z.top-u-B;g(n.result_area).removeClass("shadowUp shadowDown").addClass("shadowUp")}else{C=z.top+(o.multiple?g(n.container).outerHeight():p);g(n.result_area).removeClass("shadowUp shadowDown").addClass("shadowDown");C+=B}return{top:C+"px",left:t+"px"}}};if(g(n.result_area).is(":visible")){g(n.result_area).css(l())}else{g(n.result_area).show(1,function(){g(this).css(l())})}};h.prototype.hideResults=function(l){if(l.prop.key_paging){l.scrollWindow(l,true);l.prop.key_paging=false}l.setCssFocusedInput(l);if(l.option.autoFillResult){}g(l.elem.results).empty();g(l.elem.result_area).hide();l.setOpenStatus(l,false);g(window).off("scroll.SelectPage");l.abortAjax(l);l.setButtonAttrDefault()};h.prototype.disabled=function(l,n){var o=l.option,m=l.elem;if(g.type(n)==="undefined"){return g(m.combo_input).prop("disabled")}if(g.type(n)==="boolean"){g(m.combo_input).prop("disabled",n);if(n){g(m.container).addClass(l.css_class.disabled)}else{g(m.container).removeClass(l.css_class.disabled)}}};h.prototype.firstPage=function(l){if(l.prop.current_page>1){l.prop.current_page=1;l.prop.page_move=true;l.suggest(l)}};h.prototype.prevPage=function(l){if(l.prop.current_page>1){l.prop.current_page--;l.prop.page_move=true;l.suggest(l)}};h.prototype.nextPage=function(l){if(l.prop.current_page<l.prop.max_page){l.prop.current_page++;l.prop.page_move=true;l.suggest(l)}};h.prototype.lastPage=function(l){console.log(l);if(l.prop.current_page<l.prop.max_page){l.prop.current_page=l.prop.max_page;l.prop.page_move=true;l.suggest(l)}};h.prototype.goPage=function(l,m){if(typeof(m)==="undefined"){m=1}if(l.prop.current_page<l.prop.max_page){l.prop.current_page=m;l.prop.page_move=true;l.suggest(l)}};h.prototype.afterAction=function(l){l.inputResize(l);g(l.elem.combo_input).change();l.setCssFocusedInput(l);if(l.option.multiple){if(l.option.selectToCloseList){l.hideResults(l);g(l.elem.combo_input).blur()}else{l.suggest(l);g(l.elem.combo_input).focus()}}else{l.hideResults(l);g(l.elem.combo_input).blur()}};h.prototype.selectCurrentLine=function(l,m){l.scrollWindow(l,true);var o=l.getCurrentLine(l);if(o){if(!l.option.multiple){g(l.elem.combo_input).val(g(o).text());g(l.elem.hidden).val(g(o).attr("pkey"))}else{g(l.elem.combo_input).val("");var n={text:g(o).text(),value:g(o).attr("pkey")};if(!l.isAlreadySelected(l,n)){l.addNewTag(l,n);l.tagValuesSet(l)}}if(l.option.selectOnly){l.setButtonAttrDefault()}if(l.option.eSelect&&g.isFunction(l.option.eSelect)){l.option.eSelect(g(o).data("dataObj"))}l.prop.prev_value=g(l.elem.combo_input).val();l.prop.selected_text=g(l.elem.combo_input).val();l.putClearButton()}l.afterAction(l)};h.prototype.putClearButton=function(){if(!this.option.multiple&&!g(this.elem.combo_input).prop("disabled")){g(this.elem.container).append(this.elem.clear_btn)}};h.prototype.selectAllLine=function(l){var m=new Array();g("li",l.elem.results).each(function(n,p){var o={text:g(p).text(),value:g(p).attr("pkey")};if(!l.isAlreadySelected(l,o)){l.addNewTag(l,o);l.tagValuesSet(l)}m.push(g(p).data("dataObj"));if(g.type(l.option.maxSelectLimit)==="number"&&l.option.maxSelectLimit>0&&l.option.maxSelectLimit===g("li.selected_tag",l.elem.element_box).size()){return false}});if(l.option.eSelect&&g.isFunction(l.option.eSelect)){l.option.eSelect(m)}l.afterAction(l)};h.prototype.unselectAllLine=function(l){var m=g("li",l.elem.results).size();g("li",l.elem.results).each(function(p,q){var o=g(q).attr("pkey");var n=g('li.selected_tag[itemvalue="'+o+'"]',l.elem.element_box);l.removeTag(l,n)});l.afterAction(l);if(l.option.eTagRemove&&g.isFunction(l.option.eTagRemove)){l.option.eTagRemove(m)}};h.prototype.clearAll=function(l){var m=0;if(l.option.multiple){m=g("li.selected_tag",l.elem.element_box).size();g("li.selected_tag",l.elem.element_box).remove()}g(l.elem.combo_input).val("");g(l.elem.hidden).val("");l.afterAction(l);g(l.elem.clear_btn).remove();if(l.option.multiple){if(l.option.eTagRemove&&g.isFunction(l.option.eTagRemove)){l.option.eTagRemove(m)}}};h.prototype.getCurrentLine=function(l){if(g(l.elem.result_area).is(":hidden")){return false}var m=g("li."+l.css_class.select,l.elem.results);if(g(m).size()){return m}else{return false}};h.prototype.isAlreadySelected=function(l,n){var o=false;if(n.value){var m=g(l.elem.hidden).val();if(m){var p=m.split(",");if(p&&p.length>0&&g.inArray(n.value,p)!=-1){o=true}}}return o};h.prototype.addNewTag=function(m,o){if(!m.option.multiple||!o){return}var n=m.template.tag.content,l;n=n.replace(m.template.tag.textKey,o.text);n=n.replace(m.template.tag.valueKey,o.value);l=g(n);if(g(m.elem.combo_input).prop("disabled")){g("span.tag_close",l).hide()}g(m.elem.combo_input).closest("li").before(l)};h.prototype.removeTag=function(l,q){var n=g(q).attr("itemvalue");var p=g(l.elem.hidden).val();if(g.type(n)!="undefined"&&p){var o=p.split(",");var m=g.inArray(n.toString(),o);if(m!=-1){o.splice(m,1);g(l.elem.hidden).val(o.toString())}}g(q).remove();l.inputResize(l)};h.prototype.tagValuesSet=function(m){if(!m.option.multiple){return}var n=g("li.selected_tag",g(m.elem.element_box));if(n&&g(n).size()>0){var l=new Array();g.each(n,function(q,o){var p=g(o).attr("itemvalue");if(g.type(p)!=="undefined"){l.push(p)}});if(l.length>0){g(m.elem.hidden).val(l.join(","))}}};h.prototype.inputResize=function(l){if(!l.option.multiple){return}var o="";var m=l.elem.combo_input.closest("li");var n=function(p,q){q.removeClass("full_width");var s=p.elem.combo_input.val().length+1;var r=(s*0.75)+"em";p.elem.combo_input.css("width",r);p.elem.combo_input.removeAttr("placeholder")};if(g("li.selected_tag",g(l.elem.element_box)).size()===0){if(l.elem.combo_input.attr("placeholder_bak")){if(!m.hasClass("full_width")){m.addClass("full_width")}l.elem.combo_input.attr("placeholder",l.elem.combo_input.attr("placeholder_bak"));l.elem.combo_input.removeAttr("style")}else{n(l,m)}}else{n(l,m)}};h.prototype.nextLine=function(m){var o=m.getCurrentLine(m);var l;if(!o){l=-1}else{l=g(m.elem.results).children("li").index(o);g(o).removeClass(m.css_class.select)}l++;if(l<g(m.elem.results).children("li").length){var n=g(m.elem.results).children("li").eq(l);g(n).addClass(m.css_class.select);m.setCssFocusedResults(m)}else{m.setCssFocusedInput(m)}m.scrollWindow(m,false)};h.prototype.prevLine=function(m){var o=m.getCurrentLine(m);var l;if(!o){l=g(m.elem.results).children("li").length}else{l=g(m.elem.results).children("li").index(o);g(o).removeClass(m.css_class.select)}l--;if(l>-1){var n=g(m.elem.results).children("li").eq(l);g(n).addClass(m.css_class.select);m.setCssFocusedResults(m)}else{m.setCssFocusedInput(m)}m.scrollWindow(m,false)};function j(l){return this.each(function(){var n=g(this),m=n.data(h.dataKey),o=g.extend({},e,n.data(),m&&m.option,typeof l==="object"&&l);if(!m){n.data(h.dataKey,(m=new h(this,o)))}})}function a(m){var l=g(m).closest("div.sp_container");return g("input.sp_input",l)}function b(){return this.each(function(){var m=a(this),l=m.data(h.dataKey);if(l){l.clearAll(l)}})}function f(){return this.each(function(){var m=a(this),l=m.data(h.dataKey);if(l&&l.elem.hidden.val()){l.setInitRecord(true)}})}function c(l){return this.each(function(){if(l&&g.isArray(l)&&l.length>0){var n=a(this),m=n.data(h.dataKey);if(m){m.clearAll(m);m.option.data=l}}})}function k(m){var l=false;this.each(function(){var o=a(this),n=o.data(h.dataKey);if(n){if(g.type(m)!=="undefined"){n.disabled(n,m)}else{l=n.disabled(n)}}});return l}function i(){var l="";this.each(function(){var n=a(this),m=n.data(h.dataKey);if(m){l+=m.elem.combo_input.val()}});return l}var d=g.fn.selectPage;g.fn.selectPage=j;g.fn.selectPage.Constructor=h;g.fn.selectPageClear=b;g.fn.selectPageRefresh=f;g.fn.selectPageData=c;g.fn.selectPageDisabled=k;g.fn.selectPageText=i;g.fn.selectPage.noConflict=function(){g.fn.selectPage=d;return this}})(window.jQuery);