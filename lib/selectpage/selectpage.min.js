(function(g){var e={data:undefined,lang:"cn",multiple:false,pagination:true,dropButton:true,listSize:10,multipleControlbar:true,maxSelectLimit:0,selectToCloseList:true,initRecord:undefined,dbTable:"tbl",keyField:"id",showField:"name",searchField:undefined,andOr:"AND",orderBy:undefined,pageSize:10,params:undefined,formatItem:undefined,autoSelectFirst:false,autoFillResult:false,noResultClean:true,selectOnly:false,inputDelay:0.5,eSelect:undefined,eOpen:undefined,eAjaxSuccess:undefined,eTagRemove:undefined,eClear:undefined};var h=function(l,m){this.setOption(m);this.setLanguage();this.setCssClass();this.setProp();this.setElem(l);this.setButtonAttrDefault();this.setInitRecord();this.eDropdownButton();this.eInput();this.eWhole()};h.version="2.14";h.dataKey="selectPageObject";h.prototype.setOption=function(n){n.searchField=n.searchField||n.showField;n.andOr=n.andOr.toUpperCase();if(n.andOr!=="AND"&&n.andOr!=="OR"){n.andOr="AND"}var l=["searchField"];for(var m=0;m<l.length;m++){n[l[m]]=this.strToArray(n[l[m]])}n.orderBy=n.orderBy||n.searchField;n.orderBy=this.setOrderbyOption(n.orderBy,n.showField);if(n.multiple&&!n.selectToCloseList){n.autoFillResult=false;n.autoSelectFirst=false}if(g.type(n.data)==="string"){n.autoSelectFirst=false}if(!n.pagination){n.pageSize=200}if(g.type(n.listSize)!=="number"||n.listSize<0){n.listSize=10}this.option=n};h.prototype.strToArray=function(l){if(!l){return""}return l.replace(/[\s　]+/g,"").split(",")};h.prototype.setOrderbyOption=function(m,p){var l=[],o=[];if(typeof m=="object"){for(var n=0;n<m.length;n++){o=g.trim(m[n]).split(" ");l[n]=(o.length==2)?o:[o[0],"ASC"]}}else{o=g.trim(m).split(" ");l[0]=(o.length==2)?o:(o[0].match(/^(ASC|DESC)$/i))?[p,o[0]]:[o[0],"ASC"]}return l};h.prototype.setLanguage=function(){var l,m=this.option;switch(m.lang){case"de":l={add_btn:"Hinzufügen-Button",add_title:"Box hinzufügen",del_btn:"Löschen-Button",del_title:"Box löschen",next:"Nächsten",next_title:"Nächsten"+m.pageSize+" (Pfeil-rechts)",prev:"Vorherigen",prev_title:"Vorherigen"+m.pageSize+" (Pfeil-links)",first_title:"Ersten (Umschalt + Pfeil-links)",last_title:"Letzten (Umschalt + Pfeil-rechts)",get_all_btn:"alle (Pfeil-runter)",get_all_alt:"(Button)",close_btn:"Schließen (Tab)",close_alt:"(Button)",loading:"lade...",loading_alt:"(lade)",page_info:"num_page_top - num_page_end von cnt_whole",select_ng:"Achtung: Bitte wählen Sie aus der Liste aus.",select_ok:"OK : Richtig ausgewählt.",not_found:"nicht gefunden",ajax_error:"Bei der Verbindung zum Server ist ein Fehler aufgetreten."};break;case"en":l={add_btn:"Add button",add_title:"add a box",del_btn:"Del button",del_title:"delete a box",next:"Next",next_title:"Next"+m.pageSize+" (Right key)",prev:"Prev",prev_title:"Prev"+m.pageSize+" (Left key)",first_title:"First (Shift + Left key)",last_title:"Last (Shift + Right key)",get_all_btn:"Get All (Down key)",get_all_alt:"(button)",close_btn:"Close (Tab key)",close_alt:"(button)",loading:"loading...",loading_alt:"(loading)",page_info:"num_page_top - num_page_end of cnt_whole",select_ng:"Attention : Please choose from among the list.",select_ok:"OK : Correctly selected.",not_found:"not found",ajax_error:"An error occurred while connecting to server."};break;case"cn":l={add_btn:"添加按钮",add_title:"添加区域",del_btn:"删除按钮",del_title:"删除区域",next:"下一页",next_title:"下"+m.pageSize+" (→)",prev:"上一页",prev_title:"上"+m.pageSize+" (←)",first_title:"首页 (Shift + ←)",last_title:"尾页 (Shift + →)",get_all_btn:"获得全部 (↓)",get_all_alt:"(按钮)",close_btn:"关闭 (Tab键)",close_alt:"(按钮)",loading:"读取中...",loading_alt:"(读取中)",page_info:"num_page_top - num_page_end (共 cnt_whole)",select_ng:"请注意：请从列表中选择.",select_ok:"OK : 已经选择.",not_found:"无查询结果",ajax_error:"连接到服务器时发生错误！"};break;case"es":l={add_btn:"Agregar boton",add_title:"Agregar una opcion",del_btn:"Borrar boton",del_title:"Borrar una opcion",next:"Siguiente",next_title:"Proximas "+m.pageSize+" (tecla derecha)",prev:"Anterior",prev_title:"Anteriores "+m.pageSize+" (tecla izquierda)",first_title:"Primera (Shift + Left)",last_title:"Ultima (Shift + Right)",get_all_btn:"Ver todos (tecla abajo)",get_all_alt:"(boton)",close_btn:"Cerrar (tecla TAB)",close_alt:"(boton)",loading:"Cargando...",loading_alt:"(Cargando)",page_info:"num_page_top - num_page_end de cnt_whole",select_ng:"Atencion: Elija una opcion de la lista.",select_ok:"OK: Correctamente seleccionado.",not_found:"no encuentre",ajax_error:"Un error ocurrió mientras conectando al servidor."};break;case"pt-br":l={add_btn:"Adicionar botão",add_title:"Adicionar uma caixa",del_btn:"Apagar botão",del_title:"Apagar uma caixa",next:"Próxima",next_title:"Próxima "+m.pageSize+" (tecla direita)",prev:"Anterior",prev_title:"Anterior "+m.pageSize+" (tecla esquerda)",first_title:"Primeira (Shift + Left)",last_title:"Última (Shift + Right)",get_all_btn:"Ver todos (Seta para baixo)",get_all_alt:"(botão)",close_btn:"Fechar (tecla TAB)",close_alt:"(botão)",loading:"Carregando...",loading_alt:"(Carregando)",page_info:"num_page_top - num_page_end de cnt_whole",select_ng:"Atenção: Escolha uma opção da lista.",select_ok:"OK: Selecionado Corretamente.",not_found:"não encontrado",ajax_error:"Um erro aconteceu enquanto conectando a servidor."};break;case"ja":l={add_btn:"追加ボタン",add_title:"入力ボックスを追加します",del_btn:"削除ボタン",del_title:"入力ボックスを削除します",next:"次へ",next_title:"次の"+m.pageSize+"件 (右キー)",prev:"前へ",prev_title:"前の"+m.pageSize+"件 (左キー)",first_title:"最初のページへ (Shift + 左キー)",last_title:"最後のページへ (Shift + 右キー)",get_all_btn:"全件取得 (下キー)",get_all_alt:"画像:ボタン",close_btn:"閉じる (Tabキー)",close_alt:"画像:ボタン",loading:"読み込み中...",loading_alt:"画像:読み込み中...",page_info:"num_page_top - num_page_end 件 (全 cnt_whole 件)",select_ng:"注意 : リストの中から選択してください",select_ok:"OK : 正しく選択されました。",not_found:"(0 件)",ajax_error:"サーバとの通信でエラーが発生しました。"};break}this.message=l};h.prototype.setCssClass=function(){var l={container:"sp_container",container_open:"sp_container_open",re_area:"sp_result_area",result_open:"sp_result_area_open",control_box:"sp_control_box",element_box:"sp_element_box",navi:"sp_navi",results:"sp_results",re_off:"sp_results_off",select:"sp_over",select_ok:"sp_select_ok",select_ng:"sp_select_ng",selected:"sp_selected",input_off:"sp_input_off",message_box:"sp_message_box",disabled:"sp_disabled",button:"sp_button",btn_on:"sp_btn_on",btn_out:"sp_btn_out",input:"sp_input",clear_btn:"sp_clear_btn",align_right:"sp_align_right"};this.css_class=l};h.prototype.setProp=function(){this.prop={disabled:false,current_page:1,max_page:1,is_loading:false,xhr:false,key_paging:false,key_select:false,prev_value:"",selected_text:"",last_input_time:undefined};this.template={tag:{content:'<li class="selected_tag" itemvalue="#item_value#">#item_text#<span class="tag_close"><i class="iconfont if-close"></i></span></li>',textKey:"#item_text#",valueKey:"#item_value#"}}};h.prototype.setElem=function(o){var n={},m=this.option,t=this.css_class;var r=g(o).outerWidth();if(r<150){r=150}n.combo_input=g(o).attr({"autocomplete":"off"}).addClass(t.input).wrap("<div>");if(m.selectOnly){n.combo_input.prop("readonly",true)}n.container=n.combo_input.parent().addClass(t.container);if(n.combo_input.prop("disabled")){if(m.multiple){n.container.addClass(t.disabled)}else{n.combo_input.addClass(t.input_off)}}n.container.width(r);n.button=g("<div>").addClass(t.button);n.dropdown=g('<span class="bs-caret"><span class="caret"></span></span>');n.clear_btn=g("<div>").html(g("<i>").addClass("iconfont if-close")).addClass(t.clear_btn).attr("title","清除内容");if(!m.dropButton){n.clear_btn.addClass(t.align_right)}n.element_box=g("<ul>").addClass(t.element_box);if(m.multiple&&m.multipleControlbar){n.control=g("<div>").addClass(t.control_box)}n.result_area=g("<div>").addClass(t.re_area);if(m.pagination){n.navi=g("<div>").addClass("pagination").append("<ul>")}n.results=g("<ul>").addClass(t.results);var l="_text",v=n.combo_input.attr("id")||n.combo_input.attr("name"),s=n.combo_input.attr("name")||"selectPage",u=s,q=v;n.hidden=g('<input type="hidden" class="sp_hidden" />').attr({name:u,id:q}).val("");n.combo_input.attr({name:s+l,id:v+l});n.container.append(n.hidden);if(m.dropButton){n.container.append(n.button);n.button.append(n.dropdown)}g(document.body).append(n.result_area);n.result_area.append(n.results);if(m.pagination){n.result_area.append(n.navi)}if(m.multiple){if(m.multipleControlbar){n.control.append('<button type="button" class="btn btn-default sp_select_all" ><i class="iconfont if-select-all"></i> 全选本页</button>');n.control.append('<button type="button" class="btn btn-default sp_unselect_all" ><i class="iconfont if-unselect-all"></i> 取消本页</button>');n.control.append('<button type="button" class="btn btn-default sp_clear_all" ><i class="iconfont if-clear"></i> 清除全部</button>');n.result_area.prepend(n.control)}n.container.addClass("sp_container_combo");n.combo_input.addClass("sp_combo_input").before(n.element_box);var w=g("<li>").addClass("input_box");w.append(n.combo_input);n.element_box.append(w);if(n.combo_input.attr("placeholder")){n.combo_input.attr("placeholder_bak",n.combo_input.attr("placeholder"))}}this.elem=n};h.prototype.setButtonAttrDefault=function(){if(this.option.dropButton){this.elem.button.attr("title",this.message.close_btn)}};h.prototype.setInitRecord=function(o){var l=this,s=l.option,n=l.elem,m="";if(g.type(n.combo_input.data("init"))!="undefined"){s.initRecord=String(n.combo_input.data("init"))}if(!o&&!s.initRecord&&n.combo_input.val()){s.initRecord=n.combo_input.val()}n.combo_input.val("");if(!o){n.hidden.val(s.initRecord)}m=o&&n.hidden.val()?n.hidden.val():s.initRecord;if(m){if(typeof s.data==="object"){var r=new Array();var q=m.split(",");g.each(q,function(p,u){for(var t=0;t<s.data.length;t++){if(s.data[t][s.keyField]==u){r.push(s.data[t]);break}}});if(!s.multiple&&r.length>1){r=[r[0]]}l.afterInit(l,r)}else{g.ajax({dataType:"json",type:"POST",url:s.data,data:{searchTable:s.dbTable,searchKey:s.keyField,searchValue:m},success:function(p){var t=null;if(s.eAjaxSuccess&&g.isFunction(s.eAjaxSuccess)){t=s.eAjaxSuccess(p)}l.afterInit(l,t.list)},error:function(p,u,t){l.ajaxErrorNotify(l,t)}})}}};h.prototype.afterInit=function(m,o){if(!o){return}if(!g.isArray(o)){o=[o]}var q=m.option,n=m.css_class;var l=function(t){var s=t[q.showField];if(q.formatItem&&g.isFunction(q.formatItem)){try{s=q.formatItem(t)}catch(p){}}return s};if(q.multiple){m.clearAll(m);g.each(o,function(p,t){var s={text:l(t),value:t[q.keyField]};if(!m.isAlreadySelected(m,s)){m.addNewTag(m,s)}});m.tagValuesSet(m);m.inputResize(m)}else{var r=o[0];m.elem.combo_input.val(l(r));m.elem.hidden.val(r[q.keyField]);m.prop.prev_value=l(r);m.prop.selected_text=l(r);if(q.selectOnly){m.elem.combo_input.attr("title",m.message.select_ok).removeClass(n.select_ng).addClass(n.select_ok)}m.putClearButton()}};h.prototype.eDropdownButton=function(){var l=this;if(l.option.dropButton){l.elem.button.mouseup(function(m){m.stopPropagation();if(l.elem.result_area.is(":hidden")&&!l.elem.combo_input.prop("disabled")){l.elem.combo_input.focus()}else{l.hideResults(l)}})}};h.prototype.eInput=function(){var m=this,o=m.option,n=m.elem;var l=function(){m.prop.page_move=false;m.suggest(m);m.setCssFocusedInput(m)};n.combo_input.keyup(function(p){m.processKey(m,p)}).keydown(function(p){m.processControl(m,p)}).focus(function(p){if(n.result_area.is(":hidden")){p.stopPropagation();m.prop.first_show=true;l()}});n.container.on("click.SelectPage","div."+m.css_class.clear_btn,function(p){p.stopPropagation();if(!m.disabled(m)){m.clearAll(m);if(o.eClear&&g.isFunction(o.eClear)){o.eClear(m)}}});n.result_area.on("mousedown.SelectPage",function(p){p.stopPropagation()});if(o.multiple){if(o.multipleControlbar){n.control.find(".sp_select_all").on("click.SelectPage",function(p){m.selectAllLine(m)});n.control.find(".sp_unselect_all").on("click.SelectPage",function(p){m.unSelectAllLine(m)});n.control.find(".sp_clear_all").on("click.SelectPage",function(p){m.clearAll(m)})}n.element_box.on("click.SelectPage",function(q){var p=q.target||q.srcElement;if(g(p).is("ul")){n.combo_input.focus()}});n.element_box.on("click.SelectPage","span.tag_close",function(){var p=g(this).closest("li");m.removeTag(m,p);l();if(o.eTagRemove&&g.isFunction(o.eTagRemove)){o.eTagRemove(1,m)}});m.inputResize(m)}};h.prototype.eWhole=function(){var l=this,m=l.css_class;var n=function(o){o.elem.combo_input.val("");if(!o.option.multiple){o.elem.hidden.val("")}o.prop.selected_text=""};g(document.body).off("mousedown.selectPage").on("mousedown.selectPage",function(q){var p=q.target||q.srcElement;var o=g(p).closest("div."+m.container);g("div."+m.container+"."+m.container_open).each(function(){if(this==o[0]){return}var r=g(this),s=r.find("input."+m.input).data(h.dataKey);if(!s.elem.combo_input.val()&&s.elem.hidden.val()&&!s.option.multiple){s.prop.current_page=1;n(s);s.hideResults(s);return true}if(s.elem.results.find("li").not("."+m.message_box).size()){if(s.option.autoFillResult){if(s.elem.hidden.val()){s.hideResults(s)}else{if(s.elem.results.find("li.sp_over").size()){s.selectCurrentLine(s,true)}else{if(s.option.autoSelectFirst){s.nextLine(s);s.selectCurrentLine(s,true)}else{s.hideResults(s)}}}}else{s.hideResults(s)}}else{if(s.option.noResultClean){n(s)}else{if(!s.option.multiple){s.elem.hidden.val("")}}s.hideResults(s)}})})};h.prototype.eResultList=function(){var l=this,m=this.css_class;l.elem.results.children("li").hover(function(){if(l.prop.key_select){l.prop.key_select=false;return}if(!g(this).hasClass(m.selected)&&!g(this).hasClass(m.message_box)){g(this).addClass(m.select);l.setCssFocusedResults(l)}},function(){g(this).removeClass(m.select)}).click(function(n){if(l.prop.key_select){l.prop.key_select=false;return}n.preventDefault();n.stopPropagation();if(!g(this).hasClass(m.selected)){l.selectCurrentLine(l,false)}})};h.prototype.eScroll=function(){var l=this,m=this.css_class;g(window).on("scroll.SelectPage",function(n){g("div."+m.container+"."+m.container_open).each(function(){var v=g(this),u=v.find("input."+m.input).data(h.dataKey),t=u.elem.result_area.offset(),s=g(window).scrollTop(),x=g(document).height(),q=g(window).height(),p=u.elem.result_area.outerHeight(),o=t.top+p,r=x>q,w=u.elem.result_area.hasClass("shadowDown");if(r){if(w){if(o>(q+s)){u.calcResultsSize(u)}}else{if(t.top<s){u.calcResultsSize(u)}}}})})};h.prototype.ePaging=function(){var l=this;if(!l.option.pagination){return}l.elem.navi.find("li.csFirstPage").off("click").on("click",function(m){m.preventDefault();l.firstPage(l)});l.elem.navi.find("li.csPreviousPage").off("click").on("click",function(m){m.preventDefault();l.prevPage(l)});l.elem.navi.find("li.csNextPage").off("click").on("click",function(m){m.preventDefault();l.nextPage(l)});l.elem.navi.find("li.csLastPage").off("click").on("click",function(m){m.preventDefault();l.lastPage(l)})};h.prototype.ajaxErrorNotify=function(l,m){l.showMessage(l.message.ajax_error)};h.prototype.showMessage=function(l,n){if(!n){return}var m='<li class="'+l.css_class.message_box+'"><i class="iconfont if-warning"></i> '+n+"</li>";l.elem.results.empty().append(m).show();l.calcResultsSize(l);l.setOpenStatus(l,true);l.elem.control.hide();if(l.option.pagination){l.elem.navi.hide()}};h.prototype.scrollWindow=function(t,q){var l=t.getCurrentLine(t),s=(l&&!q)?l.offset().top:t.elem.container.offset().top,n;t.prop.size_li=t.elem.results.children("li:first").outerHeight();n=t.prop.size_li;var r,p=g(window).height(),o=g(window).scrollTop(),m=o+p-n;if(l.length){if(s<o||n>p){r=s-o}else{if(s>m){r=s-m}else{return}}}else{if(s<o){r=s-o}}window.scrollBy(0,r)};h.prototype.setOpenStatus=function(m,l){var o=m.elem,n=m.css_class;if(l){o.container.addClass(n.container_open);o.result_area.addClass(n.result_open)}else{o.container.removeClass(n.container_open);o.result_area.removeClass(n.result_open)}};h.prototype.setCssFocusedInput=function(l){};h.prototype.setCssFocusedResults=function(l){};h.prototype.checkValue=function(m){var l=m.elem.combo_input.val();if(l!=m.prop.prev_value){m.prop.prev_value=l;m.prop.first_show=false;if(m.option.selectOnly){m.setButtonAttrDefault()}if(!m.option.multiple&&!l){m.elem.combo_input.val("");m.elem.hidden.val("");m.elem.clear_btn.remove()}m.suggest(m)}};h.prototype.processKey=function(l,m){if(g.inArray(m.keyCode,[37,38,39,40,27,9,13])===-1){if(m.keyCode!=16){l.setCssFocusedInput(l)}l.inputResize(l);if(g.type(l.option.data)==="string"){l.prop.last_input_time=m.timeStamp;setTimeout(function(){if((m.timeStamp-l.prop.last_input_time)===0){l.checkValue(l)}},l.option.inputDelay*1000)}else{l.checkValue(l)}}};h.prototype.processControl=function(l,m){if((g.inArray(m.keyCode,[37,38,39,40,27,9])>-1&&l.elem.result_area.is(":visible"))||(g.inArray(m.keyCode,[13,9])>-1&&l.getCurrentLine(l))){m.preventDefault();m.stopPropagation();m.cancelBubble=true;m.returnValue=false;switch(m.keyCode){case 37:if(m.shiftKey){l.firstPage(l)}else{l.prevPage(l)}break;case 38:l.prop.key_select=true;l.prevLine(l);break;case 39:if(m.shiftKey){l.lastPage(l)}else{l.nextPage(l)}break;case 40:if(l.elem.results.children("li").length){l.prop.key_select=true;l.nextLine(l)}else{l.suggest(l)}break;case 9:l.prop.key_paging=true;l.selectCurrentLine(l,true);break;case 13:l.selectCurrentLine(l,true);break;case 27:l.prop.key_paging=true;l.hideResults(l);break}}};h.prototype.abortAjax=function(l){if(l.prop.xhr){l.prop.xhr.abort();l.prop.xhr=false}};h.prototype.suggest=function(m){var n,o=g.trim(m.elem.combo_input.val());if(m.option.multiple){n=o}else{if(o&&o===m.prop.selected_text){n=""}else{n=o}}n=n.split(/[\s　]+/);if(m.option.eOpen&&g.isFunction(m.option.eOpen)){m.option.eOpen.call(m)}m.abortAjax(m);var l=m.prop.current_page||1;if(typeof m.option.data=="object"){m.searchForJson(m,n,l)}else{m.searchForDb(m,n,l)}};h.prototype.setLoading=function(l){if(l.elem.results.html()===""){l.setOpenStatus(l,true)}};h.prototype.searchForDb=function(t,q,s){var m=t.option;if(!m.eAjaxSuccess||!g.isFunction(m.eAjaxSuccess)){t.hideResults(t)}var n=m.params,r={},o=m.searchField;if(q.length&&q[0]&&q[0]!==t.prop.prev_value){s=1}var l={q_word:q,pageNumber:s,pageSize:m.pageSize,andOr:m.andOr,orderBy:m.orderBy,searchTable:m.dbTable};l[o]=q[0];if(n&&g.isFunction(n)){var u=n.call(t);if(u&&g.isPlainObject(u)){r=g.extend({},l,u)}else{r=l}}else{r=l}t.prop.xhr=g.ajax({dataType:"json",url:m.data,type:"POST",data:r,success:function(x){if(!x||!g.isPlainObject(x)){t.hideResults(t);t.ajaxErrorNotify(t,errorThrown);return}var y={},w={};try{y=m.eAjaxSuccess(x);w.originalResult=y.list;w.cnt_whole=y.totalRow}catch(z){t.showMessage(t,t.message.ajax_error);return}w.candidate=[];w.keyField=[];if(typeof w.originalResult!="object"){t.prop.xhr=null;t.notFoundSearch(t);return}w.cnt_page=w.originalResult.length;for(var v=0;v<w.cnt_page;v++){for(var p in w.originalResult[v]){if(p==m.keyField){w.keyField.push(w.originalResult[v][p])}if(p==m.showField){w.candidate.push(w.originalResult[v][p])}}}t.prepareResults(t,w,q,s)},error:function(p,w,v){if(w!="abort"){t.hideResults(t);t.ajaxErrorNotify(t,v)}},complete:function(){t.prop.xhr=null}})};h.prototype.searchForJson=function(z,r,B){var A=z.option,v=[],n=[],l=[],H={},E=0,y=[];do{n[E]=r[E].replace(/\W/g,"\\$&").toString();y[E]=new RegExp(n[E],"gi");E++}while(E<r.length);for(E=0;E<A.data.length;E++){var D=false,t=A.data[E],u;for(var C=0;C<y.length;C++){u=t[A.showField];if(A.formatItem&&g.isFunction(A.formatItem)){u=A.formatItem(t)}if(u.match(y[C])){D=true;if(A.andOr=="OR"){break}}else{D=false;if(A.andOr=="AND"){break}}}if(D){v.push(t)}}var K=new RegExp("^"+n[0]+"$","gi"),I=new RegExp("^"+n[0],"gi"),J=[],G=[],F=[];for(E=0;E<v.length;E++){var x=A.orderBy[0][0];var m=String(v[E][x]);if(m.match(K)){J.push(v[E])}else{if(m.match(I)){G.push(v[E])}else{F.push(v[E])}}}if(A.orderBy[0][1].match(/^asc$/i)){J=z.sortAsc(z,J);G=z.sortAsc(z,G);F=z.sortAsc(z,F)}else{J=z.sortDesc(z,J);G=z.sortDesc(z,G);F=z.sortDesc(z,F)}l=l.concat(J).concat(G).concat(F);H.cnt_whole=l.length;if(!z.prop.page_move){if(!A.multiple){var w=z.elem.hidden.val();if(g.type(w)!=="undefined"&&g.trim(w)!==""){var s=0;g.each(l,function(p,M){if(M[A.keyField]==w){s=p+1;return false}});B=Math.ceil(s/A.pageSize);if(B<1){B=1}z.prop.current_page=B}}}else{if(l.length<=((B-1)*A.pageSize)){B=1;z.prop.current_page=1}}var q=(B-1)*A.pageSize,o=q+A.pageSize;H.originalResult=[];for(E=q;E<o;E++){if(l[E]===undefined){break}H.originalResult.push(l[E]);for(var L in l[E]){if(L==A.keyField){if(H.keyField===undefined){H.keyField=[]}H.keyField.push(l[E][L])}if(L==A.showField){if(H.candidate===undefined){H.candidate=[]}H.candidate.push(l[E][L])}}}if(H.candidate===undefined){H.candidate=[]}H.cnt_page=H.candidate.length;z.prepareResults(z,H,r,B)};h.prototype.sortAsc=function(m,l){l.sort(function(p,n){var q=p[m.option.orderBy[0][0]],o=n[m.option.orderBy[0][0]];return g.type(q)==="number"?q-o:String(q).localeCompare(String(o))});return l};h.prototype.sortDesc=function(m,l){l.sort(function(p,n){var q=p[m.option.orderBy[0][0]],o=n[m.option.orderBy[0][0]];return g.type(q)==="number"?o-q:String(o).localeCompare(String(q))});return l};h.prototype.notFoundSearch=function(l){l.elem.results.empty();l.calcResultsSize(l);l.setOpenStatus(l,true);l.setCssFocusedInput(l)};h.prototype.prepareResults=function(n,o,p,l){if(n.option.pagination){n.setNavi(n,o.cnt_whole,o.cnt_page,l)}if(!o.keyField){o.keyField=false}if(n.option.selectOnly&&o.candidate.length===1&&o.candidate[0]==p[0]){n.elem.hidden.val(o.keyField[0]);this.setButtonAttrDefault()}var m=false;if(p&&p.length&&p[0]){m=true}n.displayResults(n,o,m)};h.prototype.setNavi=function(y,w,x,m){var n=function(H,E,z,D){if(E.find("li").size()===0){E.hide().empty();var B="",F="iconfont if-first",I="iconfont if-previous",A="iconfont if-next",C="iconfont if-last";if(z==1){B=" disabled "}E.append('<li class="csFirstPage'+B+'" title="'+H.message.first_title+'" ><a href="javascript:void(0);"> <i class="'+F+'"></i> </a></li>');E.append('<li class="csPreviousPage'+B+'" title="'+H.message.prev_title+'" ><a href="javascript:void(0);"><i class="'+I+'"></i></a></li>');var G="第 "+z+" 页 ( 共"+D+"页 ) ";E.append('<li class="pageInfoBox"><a href="javascript:void(0);"> '+G+" </a></li>");B=z===D?" disabled ":"";E.append('<li class="csNextPage'+B+'" title="'+H.message.next_title+'" ><a href="javascript:void(0);"><i class="'+A+'"></i></a></li>');E.append('<li class="csLastPage'+B+'" title="'+H.message.last_title+'" ><a href="javascript:void(0);"> <i class="'+C+'"></i> </a></li>');E.show()}};var t=y.elem.navi.find("ul"),r=Math.ceil(w/y.option.pageSize);if(r===0){m=0}else{if(r<m){m=r}else{if(m===0){m=1}}}y.prop.current_page=m;y.prop.max_page=r;n(y,t,m,r);var l=t.find("li.pageInfoBox"),v="第 "+m+" 页(共"+r+"页)";l.html('<a href="javascript:void(0);"> '+v+" </a>");var s="disabled",p=t.find("li.csFirstPage"),q=t.find("li.csPreviousPage"),o=t.find("li.csNextPage"),u=t.find("li.csLastPage");if(m===1||m===0){if(!p.hasClass(s)){p.addClass(s)}if(!q.hasClass(s)){q.addClass(s)}}else{if(p.hasClass(s)){p.removeClass(s)}if(q.hasClass(s)){q.removeClass(s)}}if(m===r||r===0){if(!o.hasClass(s)){o.addClass(s)}if(!u.hasClass(s)){u.addClass(s)}}else{if(o.hasClass(s)){o.removeClass(s)}if(u.hasClass(s)){u.removeClass(s)}}if(r>1){y.ePaging()}};h.prototype.displayResults=function(z,y,r){var l=z.option,n=z.elem;n.results.hide().empty();if(l.multiple&&g.type(l.maxSelectLimit)==="number"&&l.maxSelectLimit>0){var o=n.element_box.find("li.selected_tag").size();if(o>0&&o>=l.maxSelectLimit){z.showMessage(z,"最多只能选择 "+l.maxSelectLimit+" 个项目");return}}if(y.candidate.length){var x=y.candidate,v=y.keyField,m=n.hidden.val(),A=m?m.split(","):new Array(),u="";for(var q=0;q<x.length;q++){if(l.formatItem&&g.isFunction(l.formatItem)){try{u=l.formatItem(y.originalResult[q])}catch(t){console.error("formatItem内容格式化函数内容设置不正确！");u=x[q]}}else{u=x[q]}var s=g("<li>").html(u).attr({pkey:v[q],title:u});if(g.inArray(v[q].toString(),A)!==-1){s.addClass(z.css_class.selected)}s.data("dataObj",y.originalResult[q]);n.results.append(s)}}else{var w='<li class="'+z.css_class.message_box+'"><i class="iconfont if-warning"></i> '+z.message.not_found+"</li>";n.results.append(w)}n.results.show();if(l.multiple&&l.multipleControlbar){n.control.show()}if(l.pagination){n.navi.show()}z.calcResultsSize(z);z.setOpenStatus(z,true);z.eResultList();z.eScroll();if(r&&y.candidate.length&&l.autoSelectFirst){z.nextLine(z)}};h.prototype.calcResultsSize=function(m){var o=m.option,n=m.elem;var l=function(){if(n.container.css("position")==="static"){var z=n.combo_input.offset();n.result_area.css({top:z.top+n.combo_input.outerHeight()+"px",left:z.left+"px"})}else{if(!o.pagination){var w=n.results.find("li:first").outerHeight(true),u=w*o.listSize;n.results.css({"max-height":u,"overflow-y":"auto"})}var A=g(document).width(),E=g(document).height(),v=g(window).height(),z=n.container.offset(),y=g(window).scrollTop(),D=n.result_area.outerWidth(),u=n.result_area.outerHeight(),q=z.left,p=n.container.outerHeight(),t=(z.left+D)>A?q-(D-n.container.outerWidth()):q,s=z.top,C=0,B=5,r=s+p+u+B,x=E>v;if((s-y-B>u)&&(x&&r>(v+y))||(!x&&r>v)){C=z.top-u-B;n.result_area.removeClass("shadowUp shadowDown").addClass("shadowUp")}else{C=z.top+(o.multiple?n.container.outerHeight():p);n.result_area.removeClass("shadowUp shadowDown").addClass("shadowDown");C+=B}return{top:C+"px",left:t+"px"}}};if(n.result_area.is(":visible")){n.result_area.css(l())}else{n.result_area.show(1,function(){g(this).css(l())})}};h.prototype.hideResults=function(l){if(l.prop.key_paging){l.scrollWindow(l,true);l.prop.key_paging=false}l.setCssFocusedInput(l);if(l.option.autoFillResult){}l.elem.results.empty();l.elem.result_area.hide();l.setOpenStatus(l,false);g(window).off("scroll.SelectPage");l.abortAjax(l);l.setButtonAttrDefault()};h.prototype.disabled=function(l,n){var o=l.option,m=l.elem;if(g.type(n)==="undefined"){return m.combo_input.prop("disabled")}if(g.type(n)==="boolean"){m.combo_input.prop("disabled",n);if(n){m.container.addClass(l.css_class.disabled)}else{m.container.removeClass(l.css_class.disabled)}}};h.prototype.firstPage=function(l){if(l.prop.current_page>1){l.prop.current_page=1;l.prop.page_move=true;l.suggest(l)}};h.prototype.prevPage=function(l){if(l.prop.current_page>1){l.prop.current_page--;l.prop.page_move=true;l.suggest(l)}};h.prototype.nextPage=function(l){if(l.prop.current_page<l.prop.max_page){l.prop.current_page++;l.prop.page_move=true;l.suggest(l)}};h.prototype.lastPage=function(l){if(l.prop.current_page<l.prop.max_page){l.prop.current_page=l.prop.max_page;l.prop.page_move=true;l.suggest(l)}};h.prototype.goPage=function(l,m){if(typeof(m)==="undefined"){m=1}if(l.prop.current_page<l.prop.max_page){l.prop.current_page=m;l.prop.page_move=true;l.suggest(l)}};h.prototype.afterAction=function(l){l.inputResize(l);l.elem.combo_input.change();l.setCssFocusedInput(l);if(l.option.multiple){if(l.option.selectToCloseList){l.hideResults(l);l.elem.combo_input.blur()}else{l.suggest(l);l.elem.combo_input.focus()}}else{l.hideResults(l);l.elem.combo_input.blur()}};h.prototype.selectCurrentLine=function(l,m){l.scrollWindow(l,true);var q=l.option,o=l.getCurrentLine(l);if(o){if(!q.multiple){l.elem.combo_input.val(o.text());l.elem.hidden.val(o.attr("pkey"))}else{l.elem.combo_input.val("");var n={text:o.text(),value:o.attr("pkey")};if(!l.isAlreadySelected(l,n)){l.addNewTag(l,n);l.tagValuesSet(l)}}if(q.selectOnly){l.setButtonAttrDefault()}if(q.eSelect&&g.isFunction(q.eSelect)){q.eSelect(o.data("dataObj"),l)}l.prop.prev_value=l.elem.combo_input.val();l.prop.selected_text=l.elem.combo_input.val();l.putClearButton()}l.afterAction(l)};h.prototype.putClearButton=function(){if(!this.option.multiple&&!this.elem.combo_input.prop("disabled")){this.elem.container.append(this.elem.clear_btn)}};h.prototype.selectAllLine=function(l){var n=l.option,m=new Array();l.elem.results.find("li").each(function(p,r){var o=g(r);var q={text:o.text(),value:o.attr("pkey")};if(!l.isAlreadySelected(l,q)){l.addNewTag(l,q);l.tagValuesSet(l)}m.push(o.data("dataObj"));if(g.type(n.maxSelectLimit)==="number"&&n.maxSelectLimit>0&&n.maxSelectLimit===l.elem.element_box.find("li.selected_tag").size()){return false}});if(n.eSelect&&g.isFunction(n.eSelect)){n.eSelect(m,l)}l.afterAction(l)};h.prototype.unSelectAllLine=function(l){var n=l.option,m=l.elem.results.find("li").size();l.elem.results.find("li").each(function(q,r){var p=g(r).attr("pkey");var o=l.elem.element_box.find('li.selected_tag[itemvalue="'+p+'"]');l.removeTag(l,o)});l.afterAction(l);if(n.eTagRemove&&g.isFunction(n.eTagRemove)){n.eTagRemove(m,l)}};h.prototype.clearAll=function(l){var n=l.option,m=0;if(n.multiple){m=l.elem.element_box.find("li.selected_tag").size();l.elem.element_box.find("li.selected_tag").remove()}l.elem.combo_input.val("");l.elem.hidden.val("");l.afterAction(l);if(!n.multiple){l.elem.clear_btn.remove()}if(n.multiple){if(n.eTagRemove&&g.isFunction(n.eTagRemove)){n.eTagRemove(m,l)}}};h.prototype.getCurrentLine=function(l){if(l.elem.result_area.is(":hidden")){return false}var m=l.elem.results.find("li."+l.css_class.select);if(m.size()){return m}else{return false}};h.prototype.isAlreadySelected=function(l,n){var o=false;if(n.value){var m=l.elem.hidden.val();if(m){var p=m.split(",");if(p&&p.length&&g.inArray(n.value,p)!=-1){o=true}}}return o};h.prototype.addNewTag=function(m,o){if(!m.option.multiple||!o){return}var n=m.template.tag.content,l;n=n.replace(m.template.tag.textKey,o.text);n=n.replace(m.template.tag.valueKey,o.value);l=g(n);if(m.elem.combo_input.prop("disabled")){l.find("span.tag_close").hide()}m.elem.combo_input.closest("li").before(l)};h.prototype.removeTag=function(l,q){var n=g(q).attr("itemvalue");var p=l.elem.hidden.val();if(g.type(n)!="undefined"&&p){var o=p.split(","),m=g.inArray(n.toString(),o);if(m!=-1){o.splice(m,1);l.elem.hidden.val(o.toString())}}g(q).remove();l.inputResize(l)};h.prototype.tagValuesSet=function(m){if(!m.option.multiple){return}var n=m.elem.element_box.find("li.selected_tag");if(n&&n.size()){var l=new Array();g.each(n,function(q,o){var p=g(o).attr("itemvalue");if(g.type(p)!=="undefined"){l.push(p)}});if(l.length){m.elem.hidden.val(l.join(","))}}};h.prototype.inputResize=function(l){if(!l.option.multiple){return}var o="",m=l.elem.combo_input.closest("li");var n=function(p,q){q.removeClass("full_width");var s=p.elem.combo_input.val().length+1,r=(s*0.75)+"em";p.elem.combo_input.css("width",r).removeAttr("placeholder")};if(l.elem.element_box.find("li.selected_tag").size()===0){if(l.elem.combo_input.attr("placeholder_bak")){if(!m.hasClass("full_width")){m.addClass("full_width")}l.elem.combo_input.attr("placeholder",l.elem.combo_input.attr("placeholder_bak")).removeAttr("style")}else{n(l,m)}}else{n(l,m)}};h.prototype.nextLine=function(m){var o=m.getCurrentLine(m),l;if(!o){l=-1}else{l=m.elem.results.children("li").index(o);o.removeClass(m.css_class.select)}l++;if(l<m.elem.results.children("li").length){var n=m.elem.results.children("li").eq(l);n.addClass(m.css_class.select);m.setCssFocusedResults(m)}else{m.setCssFocusedInput(m)}m.scrollWindow(m,false)};h.prototype.prevLine=function(m){var o=m.getCurrentLine(m),l;if(!o){l=m.elem.results.children("li").length}else{l=m.elem.results.children("li").index(o);o.removeClass(m.css_class.select)}l--;if(l>-1){var n=m.elem.results.children("li").eq(l);n.addClass(m.css_class.select);m.setCssFocusedResults(m)}else{m.setCssFocusedInput(m)}m.scrollWindow(m,false)};function j(l){return this.each(function(){var n=g(this),m=n.data(h.dataKey),o=g.extend({},e,n.data(),m&&m.option,typeof l==="object"&&l);if(!m){n.data(h.dataKey,(m=new h(this,o)))}})}function a(l){return g(l).closest("div.sp_container").find("input.sp_input")}function b(){return this.each(function(){var m=a(this),l=m.data(h.dataKey);if(l){l.clearAll(l)}})}function f(){return this.each(function(){var m=a(this),l=m.data(h.dataKey);if(l&&l.elem.hidden.val()){l.setInitRecord(true)}})}function c(l){return this.each(function(){if(l&&g.isArray(l)&&l.length){var n=a(this),m=n.data(h.dataKey);if(m){m.clearAll(m);m.option.data=l}}})}function k(m){var l=false;this.each(function(){var o=a(this),n=o.data(h.dataKey);if(n){if(g.type(m)!=="undefined"){n.disabled(n,m)}else{l=n.disabled(n)}}});return l}function i(){var l="";this.each(function(){var n=a(this),m=n.data(h.dataKey);if(m){l+=m.elem.combo_input.val()}});return l}var d=g.fn.selectPage;g.fn.selectPage=j;g.fn.selectPage.Constructor=h;g.fn.selectPageClear=b;g.fn.selectPageRefresh=f;g.fn.selectPageData=c;g.fn.selectPageDisabled=k;g.fn.selectPageText=i;g.fn.selectPage.noConflict=function(){g.fn.selectPage=d;return this}})(window.jQuery);